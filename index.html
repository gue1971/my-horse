<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>出資馬一覧</title>
<style>
  :root{
    --fs-body: clamp(13px, 2.6vw, 16px);
    --fs-name: clamp(14px, 3.3vw, 18px);
    --fs-meta: clamp(12px, 2.4vw, 14px);
    --gap: 12px;
  }
  html,body{height:100%}
  body{
    margin:0; background:#000; color:#fff;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    font-size: var(--fs-body); display:flex; flex-direction:column;
  }
  header, footer{background:#222; padding:10px; flex-shrink:0}
  header{display:flex; align-items:center; justify-content:space-between}
  header h1{margin:0; font-size:1.2em; color:#fff; letter-spacing:0.02em}
  nav{display:flex; gap:10px}
  nav button{
    background:#444; border:0; color:#fff; padding:6px 12px; cursor:pointer;
    font-size: clamp(12px, 2.4vw, 14px);
  }
  nav button.active{background:#666}
  main{ flex:1; overflow-y:auto; padding:8px 1px 8px 1px; }
  .grid{ display:grid; gap:var(--gap); grid-template-columns: repeat(auto-fit, minmax(clamp(340px, 95vw, 560px), 1fr)); }
  @media (min-width: 720px){ .grid{ grid-template-columns: repeat(auto-fit, minmax(420px, 1fr)); } }
  @media (min-width: 1080px){ .grid{ grid-template-columns: repeat(auto-fit, minmax(520px, 1fr)); } }
  .card{ background:#333; display:flex; gap:10px; align-items:center; box-shadow:0 2px 6px rgba(0,0,0,.6); }
  .card .photo-link{ display:flex; align-items:center; justify-content:center; flex:0 0 clamp(52%, 200px, 64%); padding-left:6px; }
  .card .photo-link img{ width:100%; aspect-ratio:4/3; object-fit:cover; display:block; }
  .info{flex:1; min-width:38%; padding:6px; display:flex; flex-direction:column; justify-content:space-between}
  .info-header{display:flex; align-items:center; gap:6px}
  .info-header a.icon{display:inline-flex; align-items:center}
  .info-header a.icon img{width:14px; height:14px}
  .info-header b{font-size:var(--fs-name); color:#fff; line-height:1.2; overflow-wrap:anywhere}
  .info p{margin:2px 0; color:#eee; font-size:var(--fs-meta); line-height:1.35}
  .links{display:flex; gap:10px; margin-top:6px; flex-wrap:wrap}
  .links a{display:flex; align-items:center; gap:4px; color:#ccc; text-decoration:none; font-size:var(--fs-meta)}
  .links img{width:14px; height:14px}
  footer{display:flex; justify-content:center; gap:12px; color:#ccc; font-size:var(--fs-meta)}
  footer a{display:flex; align-items:center; gap:4px; color:#ccc; text-decoration:none}
  footer img{width:14px; height:14px}
  a, a:visited, a:hover, a:active{color:inherit; text-decoration:none}
</style>
</head>
<body>
  <header>
    <h1>出資馬</h1>
    <nav>
      <button class="tab active"  onclick="showTab('active')">現役馬</button>
      <button class="tab"         onclick="showTab('retired')">引退馬</button>
      <button class="tab"         onclick="showTab('notable')">活躍馬</button>
    </nav>
  </header>
  <main>
    <div id="active"  class="grid tab-content"></div>
    <div id="retired" class="grid tab-content" style="display:none;"></div>
    <div id="notable" class="grid tab-content" style="display:none;"></div>
  </main>
  <footer>
    <a href="https://www.jra.go.jp/"><img src="icons/jra.png" alt="JRA">JRA</a>
    <a href="https://www.jbis.or.jp/"><img src="icons/jbis.png" alt="JBIS">JBIS</a>
    <a href="https://race.netkeiba.com/bookmark/bookmark.html?rf=navi"><img src="icons/netkeiba.png" alt="netkeiba">netkeiba</a>
    <a href="https://www.umadb.com/member/"><img src="icons/db.png" alt="一口DB">一口馬主DB</a>
  </footer>

<script>
const PLACEHOLDER_IMG = 'images/placeholder.jpg';
const clubIcon = {
  carrot:'icons/carrot.gif', silk:'icons/silk.gif', tokyo:'icons/tokyo.gif',
  win:'icons/win.gif', union:'icons/union.gif', normandy:'icons/normandy.gif'
};

function birthPriceLine(row){
  const b=(row.birth||"").trim(), p=(row.price||"").replace(/,/g,"").trim();
  if (!b && !p) return "";
  if (b && p) return `${b}生　${p}募集`;
  if (b) return `${b}生`;
  return `${p}募集`;
}
const safe = v => (v && v.trim()) ? v.trim() : "#";
const photoSrc = row => (row.image && row.image.trim()) || (row.slug ? `images/${row.slug}.jpg` : PLACEHOLDER_IMG);
const pageHref = row => (row.page && row.page.trim()) || (row.slug ? `horses/${row.slug}.html` : "#");

function buildCard(row){
  const card = document.createElement('div'); card.className='card';
  const aPhoto=document.createElement('a'); aPhoto.className='photo-link'; aPhoto.href=pageHref(row);
  const img=document.createElement('img'); img.src=photoSrc(row); img.alt=row.name||"";
  aPhoto.appendChild(img);

  const info=document.createElement('div'); info.className='info';
  const top=document.createElement('div');
  const header=document.createElement('div'); header.className='info-header';

  const iconA=document.createElement('a'); iconA.className='icon';
  iconA.href = row.clubPage ? row.clubPage : "#";
  if (row.clubPage) { iconA.target="_blank"; iconA.rel="noopener"; }
  const iconImg=document.createElement('img');
  iconImg.src = clubIcon[(row.club||"").trim()] || clubIcon.carrot;
  iconImg.alt = row.club||"club";
  iconA.appendChild(iconImg);

  const b=document.createElement('b'); b.textContent=row.name||"";
  header.appendChild(iconA); header.appendChild(b); top.appendChild(header);

  const addP=t=>{ if(!t) return; const p=document.createElement('p'); p.textContent=t; top.appendChild(p); };
  addP(row.sire    ? `父 ${row.sire}`      : "");
  addP(row.dam     ? `母 ${row.dam}`       : "");
  addP(row.damsire ? `母父 ${row.damsire}` : "");
  addP(row.farm    ? `生産 ${row.farm}`    : "");
  addP(row.stable  ? `厩舎 ${row.stable}`  : "");
  const bp=birthPriceLine(row); addP(bp);

  const links=document.createElement('div'); links.className='links';
  links.innerHTML = `
    <a href="${safe(row.jra)}"><img src="icons/jra.png" alt="">JRA</a>
    <a href="${safe(row.jbis)}"><img src="icons/jbis.png" alt="">JBIS</a>
    <a href="${safe(row.bbs)}"><img src="icons/netkeiba.png" alt="">BBS</a>`;

  info.appendChild(top); info.appendChild(links);
  card.appendChild(aPhoto); card.appendChild(info);
  return card;
}

function renderAll(list){
  const active=document.getElementById('active');
  const retired=document.getElementById('retired');
  const notable=document.getElementById('notable');
  active.innerHTML = retired.innerHTML = notable.innerHTML = '';

  list.forEach(h=>{
    (h.status==='active' ? active : retired).appendChild(buildCard(h));
    if (h.notable) notable.appendChild(buildCard(h));
  });
}

fetch('data/horses.json')
  .then(r=>r.json())
  .then(renderAll)
  .catch(console.error);

function showTab(tab){
  document.querySelectorAll('.tab-content').forEach(el=>el.style.display='none');
  document.getElementById(tab).style.display='grid';
  document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
  document.querySelector(`.tab[onclick="showTab('${tab}')"]`).classList.add('active');
}
</script>
</body>
</html>
