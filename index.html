<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>出資馬一覧</title>
<style>
  body{margin:0;background:#000;color:#fff;font-family:sans-serif;display:flex;flex-direction:column}
  header,footer{background:#222;padding:10px;flex-shrink:0}
  header{display:flex;align-items:center;justify-content:space-between}
  header h1{margin:0;font-size:1.2em}
  nav{display:flex;gap:10px}
  nav button{background:#444;border:0;color:#fff;padding:6px 12px;cursor:pointer}
  nav button.active{background:#666}
  main{flex:1;overflow-y:auto;padding:8px 2px}
  .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(clamp(340px,95vw,560px),1fr))}
  .card{background:#333;display:flex;gap:10px;align-items:center;box-shadow:0 2px 6px rgba(0,0,0,.6)}
  .photo-link{display:flex;align-items:center;justify-content:center;flex:0 0 clamp(52%,200px,64%);padding-left:6px}
  .photo-link img{width:100%;aspect-ratio:4/3;object-fit:cover}
  .info{flex:1;padding:6px;display:flex;flex-direction:column;justify-content:space-between}
  .info-header{display:flex;align-items:center;gap:6px}
  .info-header a.icon img{width:14px;height:14px}
  .info-header b{font-size:1em;color:#fff;line-height:1.2}
  .info p{margin:2px 0;color:#eee;font-size:0.85em}
  .links{display:flex;gap:10px;margin-top:6px;flex-wrap:wrap}
  .links a{display:flex;align-items:center;gap:4px;color:#ccc;text-decoration:none;font-size:0.8em}
  .links img{width:14px;height:14px}
  footer{display:flex;justify-content:center;gap:12px;color:#ccc;font-size:0.8em}
  footer a{display:flex;align-items:center;gap:4px;color:#ccc;text-decoration:none}
  footer img{width:14px;height:14px}
</style>
</head>
<body>
  <header>
    <h1>出資馬</h1>
    <nav>
      <button class="tab active" onclick="showTab('active')">現役馬</button>
      <button class="tab" onclick="showTab('retired')">引退馬</button>
      <button class="tab" onclick="showTab('notable')">活躍馬</button>
    </nav>
  </header>

  <main>
    <div id="active" class="grid tab-content"></div>
    <div id="retired" class="grid tab-content" style="display:none;"></div>
    <div id="notable" class="grid tab-content" style="display:none;"></div>
  </main>

  <footer>
    <a href="https://www.jra.go.jp/"><img src="icons/jra.png" alt="JRA">JRA</a>
    <a href="https://www.jbis.or.jp/"><img src="icons/jbis.png" alt="JBIS">JBIS</a>
    <a href="https://race.netkeiba.com/bookmark/bookmark.html?rf=navi"><img src="icons/netkeiba.png" alt="netkeiba">netkeiba</a>
    <a href="https://www.umadb.com/member/"><img src="icons/db.png" alt="一口DB">一口馬主DB</a>
  </footer>

<script>
function getBbsUrl(id) {
  const ua = navigator.userAgent;
  const isMobile = /iPhone|Android.+Mobile/.test(ua);
  return isMobile
    ? `https://db.sp.netkeiba.com/horse/horse_bbs.html?id=${id}`
    : `https://db.netkeiba.com/?pid=horse_board&id=${id}`;
}

function safe(h){ return (h && h.trim()) ? h.trim() : "#"; }

function buildCard(row){
  const card=document.createElement('div'); card.className='card';
  const aPhoto=document.createElement('a'); aPhoto.className='photo-link'; aPhoto.href=safe(row.page);
  const img=document.createElement('img'); img.src=row.image||'images/placeholder.jpg'; img.alt=row.name||"";
  aPhoto.appendChild(img);
  const info=document.createElement('div'); info.className='info';
  const top=document.createElement('div');
  const header=document.createElement('div'); header.className='info-header';
  const iconA=document.createElement('a'); iconA.className='icon'; iconA.href=row.clubPage||'#';
  const iconImg=document.createElement('img'); iconImg.src=`icons/${row.club}.gif`; iconA.appendChild(iconImg);
  const b=document.createElement('b'); b.textContent=row.name||"";
  header.appendChild(iconA); header.appendChild(b); top.appendChild(header);

  function addP(t){ if(!t) return; const p=document.createElement('p'); p.textContent=t; top.appendChild(p); }
  addP(row.sire?`父 ${row.sire}`:"");
  addP(row.dam?`母 ${row.dam}`:"");
  addP(row.damsire?`母父 ${row.damsire}`:"");
  addP(row.farm?`生産 ${row.farm}`:"");
  addP(row.stable?`厩舎 ${row.stable}`:"");
  if(row.birth || row.price) addP(`${row.birth||""}生　${row.price||""}募集`);

  const links=document.createElement('div'); links.className='links';
  const a1=document.createElement('a'); a1.href=safe(row.jra); a1.innerHTML='<img src="icons/jra.png">JRA';
  const a2=document.createElement('a'); a2.href=safe(row.jbis); a2.innerHTML='<img src="icons/jbis.png">JBIS';
  links.appendChild(a1); links.appendChild(a2);
  if(row.netkeiba_horse_id){
    const a3=document.createElement('a');
    a3.href=getBbsUrl(row.netkeiba_horse_id);
    a3.innerHTML='<img src="icons/netkeiba.png">BBS';
    links.appendChild(a3);
  }
  info.appendChild(top); info.appendChild(links);
  card.appendChild(aPhoto); card.appendChild(info);
  return card;
}

function render(data){
  const active=document.getElementById('active');
  const retired=document.getElementById('retired');
  const notable=document.getElementById('notable');
  active.innerHTML=''; retired.innerHTML=''; notable.innerHTML='';
  data.forEach(row=>{
    const card=buildCard(row);
    if(row.notable){notable.appendChild(card);}
    else if(row.status==="retired"){retired.appendChild(card);}
    else{active.appendChild(card);}
  });
}

// ここで JSON 読み込み（例: fetch("data/horses.json")）
fetch("data/horses.json")
  .then(res=>res.json())
  .then(data=>render(data));

function showTab(tab){
  document.querySelectorAll('.tab-content').forEach(el=>el.style.display='none');
  document.getElementById(tab).style.display='grid';
  document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
  document.querySelector(`.tab[onclick="showTab('${tab}')"]`).classList.add('active');
}
</script>
</body>
</html>
